<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=1, initial-scale=1.0">
    <title>HTML &#10095; MD</title>
    <link rel="icon" type="image/png" href="favicon.ico" sizes="any">
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <style>
        .wrapper {
            display: flex;
            background: #1b1d23;
            color: #abb2bf;
            width: 100%;
            font-size: 1.1em;
            line-height: 1.6em;
            margin: auto;
        }
        
        .wrapper>div {
            width: 50%;
            margin: .5em;
        }
        
        .header {
            position: absolute;
            display: flex;
            width: 48%;
            /* justify-content: right; */
            left: 60%;
        }
        
        .toggle {
            margin-left: 5em;
            margin-top: 1em;
            cursor: pointer;
            color: darkorange;
        }

        .beauty {
            margin-left: 5em;
            margin-top: 1em;
            cursor: pointer;
            color: darkcyan;
        }
        
        .MDcontainer h2 {
            color: steelblue;
            line-height: 1em;
            margin-top: .5em;
            margin-left: 1.5em;
        }
        
        .HTMLcontainer h2 {
            color: darkred;
            line-height: 1em;
            margin-top: .5em;
            margin-left: 1.5em;
        }
        
        .renderedContainer>h2 {
            color: darkolivegreen;
            line-height: 1em;
            margin-top: .5em;
            margin-left: .5em;
        }
        
        #HTML,
        #MD,
        .rendered {
            width: 100%;
            height: 90vh;
            background: #1b1d23;
            color: #adbac7;
            font-size: 14px;
            line-height: 1.5em;
            padding: .5em;
            overflow-y: scroll;
            border: 1px solid #444c56;
            border-radius: 6px;
        }
        
        textarea::-webkit-scrollbar,
        .wrapper>div::-webkit-scrollbar {
            display: none;
        }
        
        .wrapper>div,
        textarea {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .renderedContainer {
            display: none;
        }
        
        .rendered {
            padding: 0 1em 1em 1em;
            border: 1px solid #444c56;
            border-radius: 6px;
        }
        
        * {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.75em;
            font-size: 16px;
            background-color: #1b1d23;
            color: #adbac7;
            max-height: 100vh;
            overflow: hidden;
        }
        
        p {
            font-size: 16px;
        }
        
        .rendered h1 a,
        .rendered h1 {
            font-size: 30px;
            line-height: 34px;
            color: #adbac7!important;
        }
        
        .rendered h2 a,
        .rendered h2 {
            font-size: 20px;
            line-height: 25px;
            color: #adbac7!important;
        }
        
        h3 a,
        h3 {
            font-size: 16px;
            line-height: 27px;
            padding-top: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #D8D8D8;
            border-top: 1px solid #D8D8D8;
            color: #adbac7!important;
        }
        
        hr {
            height: 1px;
            background-color: #d8d8d8;
            border: none;
            width: 100%;
            margin: 0px;
        }
        
        a[href] {
            color: #1e8ad6;
            text-decoration: none;
        }
        
        a[href]:hover {
            color: #3ba0e6;
        }
        
        img {
            max-width: 100%;
        }
        
        li {
            line-height: 1.5em;
        }
        
        pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #2b333b;
            border-radius: 6px;
        }
        
        pre code {
            display: inline;
            max-width: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0;
        }
        
        .iblize pre,
        .iblize-dark {
            color: #a3b8c2;
            background-color: #1b1d23;
        }
        
        .iblize .iblize_linenumber {
            padding: 10px;
        }
        
        .iblize .iblize_linenumber {
            border-right: 1px solid #444c56;
        }
        
        .iblize .token.title.important {
            color: #e05269;
        }
        
        .iblize .token.list.punctuation {
            color: #e0a752;
        }
        
        .iblize .token.url {
            color: #7ab87d;
        }
    </style>
</head>

<body>

    <div class="wrapper">
        <div class="MDcontainer">
            <h2>Markdown</h2>
            <div id="MD"></div>
            <!-- <textarea name="MD" id="MD"></textarea> -->
        </div>
        <div class="header">
            <span class="toggle">show HTML preview</span>
            <span class="beauty">format HTML</span>
        </div>
        <div class="renderedContainer" style="display:none">
            <h2>Preview</h2>
            <div class="rendered"></div>
        </div>
        <div class="HTMLcontainer">
            <h2>HTML</h2>
            <div id="HTML"></div>
            <!-- <textarea name="HTML" id="HTML"></textarea> -->
        </div>

    </div>
</body>
<script src="https://unpkg.com/iblize/dist/iblize.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.2.0/markdown-it.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.0/beautify-html.js"></script>

<script>
    let HTMLtextArea = document.getElementById('HTML');
    let renderedContainer = document.querySelector('div.renderedContainer');
    let rendered = document.querySelector('div.rendered');
    let HTMLcontainer = document.querySelector('div.HTMLcontainer');
    let MDtextArea = document.getElementById('MD');
    const BeautifyOptions = {
        "indent_size": "2",
        "indent_char": " ",
        "max_preserve_newlines": "-1",
        "preserve_newlines": false,
        "keep_array_indentation": false,
        "break_chained_methods": false,
        "indent_scripts": "normal",
        "brace_style": "collapse",
        "space_before_conditional": true,
        "unescape_strings": false,
        "jslint_happy": false,
        "end_with_newline": false,
        "wrap_line_length": "0",
        "indent_inner_html": false,
        "comma_first": false,
        "e4x": false,
        "indent_empty_lines": false
    }

    // codeArea (iblize) for HTML
    const iblizeHTML = new Iblize("#HTML", {
        language: "html",
    });
    // codeArea (iblize) for Markdown
    const iblizeMD = new Iblize("#MD", {
        language: "markdown",
    });


    // markdown to HTML converter
    var converter = new showdown.Converter();
    // HTML to markdown converter
    var turndownService = new TurndownService({
        headingStyle: 'atx',
        bulletListMarker: '-',
        codeBlockStyle: 'fenced',
        fence: '```',
        preformattedCode: false,
    })


    // beautify HTML code
    document.querySelector('.beauty').addEventListener("click", function(event) {
        let valueHTML = iblizeHTML.getValue();
        valueHTML = html_beautify(valueHTML, BeautifyOptions)
        iblizeHTML.setValue(valueHTML);
    })


    //
    // get formatted text & past in HTML textbox , render MD and past in MD textbox
    document.addEventListener('paste', function(e) {
        e.preventDefault();
        let pastedText = e.clipboardData.getData('text/html');
        // beautify HTML code
        pastedText = html_beautify(pastedText, BeautifyOptions)

        iblizeHTML.setValue(pastedText);
        // HTMLtextArea.innerHTML = pastedText
        const valueHTML = iblizeHTML.getValue();
        var markdown = turndownService.turndown(valueHTML)
        markdown = markdown.replace(/[\u00A0-\u9999<>\&]/g, function(i) {
            return '&#' + i.charCodeAt(0) + ';';
        });
        iblizeMD.setValue(markdown);

        // MDtextArea.value = markdown;

    });


    //
    // on new input in HTML textarea render MD textarea
    HTMLtextArea.addEventListener("input", function(event) {
        const valueHTML = iblizeHTML.getValue();
        // console.log(valueHTML)
        var markdown = turndownService.turndown(valueHTML)
        markdown = markdown.replace(/[\u00A0-\u9999<>\&]/g, function(i) {
            return '&#' + i.charCodeAt(0) + ';';
        });
        MDtextArea.value = markdown;
        iblizeMD.setValue(markdown);

    });


    //
    // on new input in MD textarea render previev div
    MDtextArea.addEventListener("input", function(event) {
        rendered.innerHTML = converter.makeHtml(iblizeMD.getValue());
    });


    //
    // toggle HTML als rendered view
    document.querySelector('.toggle').addEventListener("click", function(event) {
        if (renderedContainer.style.display === "none") {
            // rendered.innerHTML = converter.makeHtml(MDtextArea.value);        
            rendered.innerHTML = converter.makeHtml(iblizeMD.getValue());
            renderedContainer.style.display = "block";
            HTMLcontainer.style.display = "none";
        } else {
            renderedContainer.style.display = "none";
            HTMLcontainer.style.display = "block";
        }
    });
</script>

</html>